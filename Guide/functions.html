

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calculating properties &mdash; SPyCCI User Guide</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=d23eb610" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
      <script src="../_static/doctools.js?v=9a2dae69"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=f281be69"></script>
      <script src="../_static/scripts/sphinx-book-theme.js"></script>
      <script>let toggleHintShow = 'Click to show';</script>
      <script>let toggleHintHide = 'Click to hide';</script>
      <script>let toggleOpenOnPrint = 'true';</script>
      <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script src="../_static/design-tabs.js?v=f930bc37"></script>
      <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
      <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
      <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Useful tools" href="tools.html" />
    <link rel="prev" title="Running calculations" href="run.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../intro.html">
            
              <img src="../_static/SPyCCI_logo_tr-01.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting-started.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../user-guide.html">User guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="systems.html">Defining molecular systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="setup.html">Setting up calculations</a></li>
<li class="toctree-l2"><a class="reference internal" href="run.html">Running calculations</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Calculating properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="tools.html">Useful tools</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributor-guide.html">Contributor’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release-notes.html">Release notes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../intro.html">Project name not set</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../intro.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../user-guide.html">User guide</a></li>
      <li class="breadcrumb-item active">Calculating properties</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/Guide/functions.md" rel="nofollow"> View page source</a>
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="run.html" class="btn btn-neutral float-left" title="Running calculations" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="tools.html" class="btn btn-neutral float-right" title="Useful tools" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="calculating-properties">
<span id="guide-functions"></span><h1>Calculating properties<a class="headerlink" href="#calculating-properties" title="Link to this heading"></a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">spycci.functions</span></code> submodule provides a suite of methods for calculating various physical properties of the system under investigation. These functions cover a broad range of topics and often perform multiple operations to assist users in computing chemically relevant results.</p>
<p>When working within the functions submodule, it is important for users to understand the implications of the calculations performed, including the underlying assumptions and approximations. As <code class="docutils literal notranslate"><span class="pre">spycci.functions</span></code> is continuously evolving, it offers workflows of both general applicability and more specialized use cases. Consequently, users are expected to have a solid understanding of each function’s structure and its required arguments.</p>
<p>Due to the complexity of many functions, they may perform only minimal sanity checks, relying on the user to ensure the accuracy and appropriateness of the input data. For instance, if a user calculates the pKa using a direct method with an unoptimized geometry, the result will reflect the properties of that unoptimized structure.</p>
<div class="warning admonition">
<p class="admonition-title">Empirical corrections</p>
<p>The functions to calculate pKa and reduction potentials take into account the self-energy of proton and electron for calculations carried out with GFN2-xTB:</p>
<ul class="simple">
<li><p>electron self energy = <span class="math notranslate nohighlight">\(111.75\, \mathrm{kcal/mol}\)</span></p></li>
<li><p>proton self energy = <span class="math notranslate nohighlight">\(164.22\, \mathrm{kcal/mol}\)</span></p></li>
</ul>
</div>
<hr class="docutils" />
<section id="pka-calculations">
<h2>pKa calculations<a class="headerlink" href="#pka-calculations" title="Link to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">spycci.functions.pka</span></code> submodule provides an interface for the computation of the <span class="math notranslate nohighlight">\(\mathrm{pKa}\)</span> of a given species. The module is, at this time, composed by four functions:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">calculate_pka</span></code>: Computes the pKa of a molecular system using the <a class="reference internal" href="#direct-scheme-pka"><span class="std std-ref">direct scheme</span></a>. The user must provide both the structures of the protomer <span class="math notranslate nohighlight">\(HA\)</span> and deprotomer <span class="math notranslate nohighlight">\(A^-\)</span> in the form of <code class="docutils literal notranslate"><span class="pre">System</span></code> objects with already optimized structures and defined electronic energy and possibly a vibronic one (see later the note about <em>Vibrationless</em> pKa calculations).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">calculate_pka_oxonium_scheme</span></code>: Computes the pKa of a molecular system using the <a class="reference internal" href="#oxonium-scheme-pka"><span class="std std-ref">oxonium scheme</span></a>. The user must provide the structures of the protomer <span class="math notranslate nohighlight">\(HA\)</span>, deprotomer <span class="math notranslate nohighlight">\(A^-\)</span>, water <span class="math notranslate nohighlight">\(H_2O\)</span> and oxonium ion <span class="math notranslate nohighlight">\(H_3O^+\)</span> in the form of <code class="docutils literal notranslate"><span class="pre">System</span></code> objects with already optimized structures and defined electronic energy and possibly a vibronic one (see later the note about <em>Vibrationless</em> pKa calculations).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">auto_calculate_pka</span></code>: Computes the pKa of a given molecule by automatically searching the lowest-energy deprotomer using CREST. Once the proper deprotomer has been identified the function takes care of the geometry optimization of both structures, the calculation of electronic energies and frequencies (see later the note about <em>Vibrationless</em> pKa calculations). With the obtained result the pka is automatically computed using the <a class="reference internal" href="#direct-scheme-pka"><span class="std std-ref">direct scheme</span></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">run_pka_workflow</span></code>: Given the protomer and deprotomer structures, the function takes care of the geometry optimization of both structures in solvent and the calculation of electronic energies and frequencies both in solvent and, if required, in vacuum. The function then computes the pka using both the direct and the oxonium schemes. If required the function computes also a pka using the COSMO-RS solvation energies using the oxonium scheme. Please notice how by running this workflow the frequency calculation cannot be skipped.</p></li>
</ul>
<div class="danger admonition">
<p class="admonition-title"><em>Vibrationless</em> pKa calculations</p>
<p>The funtions <code class="docutils literal notranslate"><span class="pre">calculate_pka</span></code>, <code class="docutils literal notranslate"><span class="pre">calculate_pka_oxonium_scheme</span></code> and <code class="docutils literal notranslate"><span class="pre">auto_calculate_pka</span></code> allow the user to run a pKa calculation without running any frequency calculation. This is sometimes used in high-trhoughput settings but its <strong>not advisable</strong> for rigorous computational chemistry. Runnig these function without frequency calculations will subtitute the Gibbs free energy terms of each molecule involved with the corresponding electronic energies loosing all vibrational components and the free energy corrections.</p>
</div>
<section id="the-direct-scheme">
<span id="direct-scheme-pka"></span><h3>The <em>“direct”</em> scheme<a class="headerlink" href="#the-direct-scheme" title="Link to this heading"></a></h3>
<p>In the direct scheme, the pKa of a given molecule <span class="math notranslate nohighlight">\(HA\)</span> is computed considering the reaction scheme:</p>
<div class="math notranslate nohighlight">
\[
HA \rightarrow H^{+} + A^{-}
\]</div>
<p>The equilibrium constant of the reaction is then computed as:</p>
<div class="math notranslate nohighlight">
\[
pK_{a} = \frac{\Delta G_{aq}}{2.303 \cdot RT}
\]</div>
<p>where:</p>
<div class="math notranslate nohighlight">
\[
\Delta G_{aq} = G_{aq}(A^{-}) + G_{aq}(H^{+}) - G_{aq}(HA) + RT \ln{(24.46)}
\]</div>
<p>where <span class="math notranslate nohighlight">\(G_{aq}(A^{-})\)</span>, <span class="math notranslate nohighlight">\(G_{aq}(H^{+})\)</span> and <span class="math notranslate nohighlight">\(G_{aq}(HA)\)</span> represents the free energies of the molecules in acquous solution and the term <span class="math notranslate nohighlight">\(RT \ln{(24.46)}\)</span> corresponds to the free energy variation associated to the change in standard state with a concentration of <span class="math notranslate nohighlight">\(1\mathrm{atm/l}\)</span> for gas phase and <span class="math notranslate nohighlight">\(1\mathrm{mol/l}\)</span> for solution phase to a standard state with concentrations of <span class="math notranslate nohighlight">\(1\mathrm{mol/l}\)</span> for both the gas phase and solution <a class="footnote-reference brackets" href="#id2" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>.</p>
<p>In the direct scheme the free-energies <span class="math notranslate nohighlight">\(G_{aq}(HA)\)</span> and <span class="math notranslate nohighlight">\(G_{aq}(A^{-})\)</span>, associated with the protomer and deprotomer, are/should be computed running optimization and frequency calculations in water solvent. The proton free energy in water <span class="math notranslate nohighlight">\(G_{aq}(H^{+})\)</span> is obtained from empyrical data. In SPyCCI the proton free energy in water plus the <span class="math notranslate nohighlight">\(RT \ln{(24.46)}\)</span> is assumed to be <span class="math notranslate nohighlight">\(-270.29 \mathrm{kcal/mol}\)</span> at <span class="math notranslate nohighlight">\(298.15\mathrm{K}\)</span>.</p>
</section>
<section id="the-oxonium-scheme">
<span id="oxonium-scheme-pka"></span><h3>The <em>“oxonium”</em> scheme<a class="headerlink" href="#the-oxonium-scheme" title="Link to this heading"></a></h3>
<p>In the oxonium scheme the pKa of a given molecule <span class="math notranslate nohighlight">\(HA\)</span> is computed considering the following reaction scheme:</p>
<div class="math notranslate nohighlight">
\[
HA + H_2O \rightarrow H_3O^{+} + A^{-}
\]</div>
<p>The equilibrium constant of such reaction can be related to the <span class="math notranslate nohighlight">\(K_a\)</span> according to:</p>
<div class="math notranslate nohighlight">
\[
K_{eq} = \frac{[H_3O^+][A^-]}{[H_2O][HA]} = \frac{K_a}{[H_2O]}
\]</div>
<p>or equivalently:</p>
<div class="math notranslate nohighlight">
\[
pK_a = pK_{eq} - \log[H_2O] = \frac{\Delta G_{aq}}{2,303 RT} - \log[H_2O]
\]</div>
<p>where, for the present scheme, <span class="math notranslate nohighlight">\(\Delta G_{aq}\)</span> can be obtained as:</p>
<div class="math notranslate nohighlight">
\[
\Delta G_{aq} = G_{aq}(A^{-}) + G_{aq}(H_3O^{+}) - G_{aq}(HA) - G_{aq}(H_2O)
\]</div>
<p>where <span class="math notranslate nohighlight">\(G_{aq}(A^{-})\)</span>, <span class="math notranslate nohighlight">\(G_{aq}(H_3O^{+})\)</span>, <span class="math notranslate nohighlight">\(G_{aq}(HA)\)</span> and <span class="math notranslate nohighlight">\(G_{aq}(H_2O)\)</span> represents the free energies of the molecules in acquous solution. In the oxonium scheme all these quantities are computationally accessible and are/should be computed running optimization and frequency calculations in water solvent. The concentration of the water <span class="math notranslate nohighlight">\([H_2O]\)</span> is computed as the ratio of the water density of <span class="math notranslate nohighlight">\(997 \mathrm{g/l}\)</span> at <span class="math notranslate nohighlight">\(25\mathrm{°C}\)</span> and its molar mass of <span class="math notranslate nohighlight">\(18.01528 \mathrm{g/mol}\)</span>.</p>
</section>
<section id="the-pka-property-structure">
<h3>The <code class="docutils literal notranslate"><span class="pre">pka</span></code> property structure<a class="headerlink" href="#the-pka-property-structure" title="Link to this heading"></a></h3>
<p>Given the peculiarity of the pKa calculation process and the variety of possible schemes employed, the <code class="docutils literal notranslate"><span class="pre">pka</span></code> property has been structured to give to the user the most clear picture possible of its origin and the involved approximations. To do so, the dedicated class object <code class="docutils literal notranslate"><span class="pre">pKa</span></code> has been defined.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">spyccy.core.properties.pKa</span></code> class is a simple object collecting all the pka values computed according to different schemes (<code class="docutils literal notranslate"><span class="pre">direct</span></code>, <code class="docutils literal notranslate"><span class="pre">oxonium</span></code> and <code class="docutils literal notranslate"><span class="pre">oxonium_cosmors</span></code>), all the free energies used in the computation (<code class="docutils literal notranslate"><span class="pre">free_energies</span></code>) and, if used, the level of theory used in the COSMO-RS based calculations (<code class="docutils literal notranslate"><span class="pre">level_of_theory_cosmors</span></code>).</p>
<p>To access the pka computed with a given scheme, an instance of the <code class="docutils literal notranslate"><span class="pre">pKa</span></code> class can be interrogated directly using a syntax equivalent to that of a dictionary. The available keys are <code class="docutils literal notranslate"><span class="pre">&quot;direct&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;oxonium&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;oxonium</span> <span class="pre">COSMO-RS&quot;</span></code>. The key provided to access the data are case-insensitive (e.g. “<code class="docutils literal notranslate"><span class="pre">direct</span></code>” and “<code class="docutils literal notranslate"><span class="pre">DIRECT</span></code>” are both valid).Alternatively each property can be accessed directly as <code class="docutils literal notranslate"><span class="pre">direct</span></code>, <code class="docutils literal notranslate"><span class="pre">oxonium</span></code> or <code class="docutils literal notranslate"><span class="pre">oxonium_cosmors</span></code> property attributes. Be aware that these arguments, together with the <code class="docutils literal notranslate"><span class="pre">level_of_theory_cosmors</span></code>, are protected as read-only properties to prevent involuntary write operations.</p>
<p>If the user decides to manually set one of the pka values the syntax <code class="docutils literal notranslate"><span class="pre">set_direct(user_value)</span></code> or <code class="docutils literal notranslate"><span class="pre">set_oxonium(user_value)</span></code> must be used. The only difference is represented by the COSMO-RS related properties <code class="docutils literal notranslate"><span class="pre">oxonium_cosmors</span></code> and <code class="docutils literal notranslate"><span class="pre">level_of_theory_cosmors</span></code> that must be set simultaneously using the setter <code class="docutils literal notranslate"><span class="pre">set_oxonium_cormors(user_value,</span> <span class="pre">engine)</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">free_energies</span></code> argument is less structured and has been thought more to be a human-readable way to access the free energy values used in the calculations. As such no read-only protection has been implemented and the argumnent can be accessed and edit as a regular class attribute.</p>
<div class="info admonition">
<p class="admonition-title">The <code class="docutils literal notranslate"><span class="pre">pka</span></code> property</p>
<p>All the functions return the computed pKa values and set the <code class="docutils literal notranslate"><span class="pre">pKa</span></code> property (<code class="docutils literal notranslate"><span class="pre">system.properties.pka</span></code>) of the protonated system. The <code class="docutils literal notranslate"><span class="pre">auto_calculate_pka</span></code> also returns the deprotonated system.</p>
</div>
</section>
<section id="the-calculate-pka-function">
<h3>The <code class="docutils literal notranslate"><span class="pre">calculate_pka()</span></code> function:<a class="headerlink" href="#the-calculate-pka-function" title="Link to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">calculate_pka</span></code> function takes as arguments the following elements:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">protonated</span></code> (<code class="docutils literal notranslate"><span class="pre">System</span></code>): molecule in its protonated form</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">deprotonated</span></code> (<code class="docutils literal notranslate"><span class="pre">System</span></code>): molecule in its deprotonated form</p></li>
</ul>
<p>Please notice how both the <code class="docutils literal notranslate"><span class="pre">protonated</span></code> and <code class="docutils literal notranslate"><span class="pre">deprotonated</span></code> molecules must already be optimized (in water) and must posses a valid electronic energy value. If the vibronic energy is provided, its contribution is taken into account during the calculation.</p>
<p>An example script that can be used to compute the pKa of a molecule is provided in what follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">spycci.engines.xtb</span><span class="w"> </span><span class="kn">import</span> <span class="n">XtbInput</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">spycci.systems</span><span class="w"> </span><span class="kn">import</span> <span class="n">System</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">spycci.functions.pka</span><span class="w"> </span><span class="kn">import</span> <span class="n">calculate_pka</span>

<span class="n">protonated</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="n">from_xyz</span><span class="p">(</span><span class="s2">&quot;protonated.xyz&quot;</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">spin</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">deprotonated</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="n">from_xyz</span><span class="p">(</span><span class="s2">&quot;deprotonated.xyz&quot;</span><span class="p">,</span> <span class="n">charge</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">spin</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">xtb</span> <span class="o">=</span> <span class="n">XtbInput</span><span class="p">(</span><span class="n">solvent</span><span class="o">=</span><span class="s2">&quot;water&quot;</span><span class="p">)</span>
<span class="n">xtb</span><span class="o">.</span><span class="n">opt</span><span class="p">(</span><span class="n">protonated</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">xtb</span><span class="o">.</span><span class="n">opt</span><span class="p">(</span><span class="n">deprotonated</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">pka</span> <span class="o">=</span> <span class="n">calculate_pka</span><span class="p">(</span><span class="n">protonated</span><span class="p">,</span> <span class="n">deprotonated</span><span class="p">)</span>
</pre></div>
</div>
<p>The computed pka value is returned as a <code class="docutils literal notranslate"><span class="pre">pKa</span></code> object (with only the <code class="docutils literal notranslate"><span class="pre">direct</span></code> property set). The function automatically sets the <code class="docutils literal notranslate"><span class="pre">pka</span></code> property of the <code class="docutils literal notranslate"><span class="pre">protonated</span></code> system accordingly. If this is not desired, the feature can be decativated using the keyword <code class="docutils literal notranslate"><span class="pre">only_return=True</span></code>.</p>
</section>
<section id="the-calculate-pka-oxonium-scheme-function">
<h3>The <code class="docutils literal notranslate"><span class="pre">calculate_pka_oxonium_scheme()</span></code> function:<a class="headerlink" href="#the-calculate-pka-oxonium-scheme-function" title="Link to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">calculate_pka_oxonium_scheme</span></code> function takes as arguments the following elements:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">protonated</span></code> (<code class="docutils literal notranslate"><span class="pre">System</span></code>): molecule in its protonated form</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">deprotonated</span></code> (<code class="docutils literal notranslate"><span class="pre">System</span></code>): molecule in its deprotonated form</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">water</span></code> (<code class="docutils literal notranslate"><span class="pre">System</span></code>): the water molecule</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">oxonium</span></code> (<code class="docutils literal notranslate"><span class="pre">System</span></code>): the oxonium ion molecule</p></li>
</ul>
<p>Please notice how both the <code class="docutils literal notranslate"><span class="pre">protonated</span></code> and <code class="docutils literal notranslate"><span class="pre">deprotonated</span></code> molecules must already be optimized (in water) and must posses a valid electronic energy value. If the vibronic energy is provided, its contribution is taken into account during the calculation.</p>
<p>An example script that can be used to compute the pKa of a molecule is provided in what follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">spycci.engines.xtb</span><span class="w"> </span><span class="kn">import</span> <span class="n">XtbInput</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">spycci.systems</span><span class="w"> </span><span class="kn">import</span> <span class="n">System</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">spycci.functions.pka</span><span class="w"> </span><span class="kn">import</span> <span class="n">calculate_pka_oxonium_scheme</span>

<span class="n">protonated</span> <span class="o">=</span> <span class="n">System</span><span class="p">(</span><span class="s2">&quot;protonated.xyz&quot;</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">spin</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">deprotonated</span> <span class="o">=</span> <span class="n">System</span><span class="p">(</span><span class="s2">&quot;deprotonated.xyz&quot;</span><span class="p">,</span> <span class="n">charge</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">spin</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">water</span> <span class="o">=</span> <span class="n">System</span><span class="p">(</span><span class="s2">&quot;water.xyz&quot;</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">spin</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">oxonium</span> <span class="o">=</span> <span class="n">System</span><span class="p">(</span><span class="s2">&quot;oxonium.xyz&quot;</span><span class="p">,</span> <span class="n">charge</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">spin</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">xtb</span> <span class="o">=</span> <span class="n">XtbInput</span><span class="p">(</span><span class="n">solvent</span><span class="o">=</span><span class="s2">&quot;water&quot;</span><span class="p">)</span>
<span class="n">xtb</span><span class="o">.</span><span class="n">opt</span><span class="p">(</span><span class="n">protonated</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">xtb</span><span class="o">.</span><span class="n">opt</span><span class="p">(</span><span class="n">deprotonated</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">xtb</span><span class="o">.</span><span class="n">opt</span><span class="p">(</span><span class="n">water</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">xtb</span><span class="o">.</span><span class="n">opt</span><span class="p">(</span><span class="n">oxonium</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">pka</span> <span class="o">=</span> <span class="n">calculate_pka_oxonium_scheme</span><span class="p">(</span><span class="n">protonated</span><span class="p">,</span> <span class="n">deprotonated</span><span class="p">,</span> <span class="n">water</span><span class="p">,</span> <span class="n">oxonium</span><span class="p">)</span>
</pre></div>
</div>
<p>Please notice how the <code class="docutils literal notranslate"><span class="pre">water</span></code> and <code class="docutils literal notranslate"><span class="pre">oxonium</span></code> structures can either be entered manually by the user or retrived by the buit-in <code class="docutils literal notranslate"><span class="pre">retrieve_structure</span></code> helper function. The syntax of the previous scheme, in the second case, becomes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">spycci.engines.xtb</span><span class="w"> </span><span class="kn">import</span> <span class="n">XtbInput</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">spycci.systems</span><span class="w"> </span><span class="kn">import</span> <span class="n">System</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">spycci.functions.pka</span><span class="w"> </span><span class="kn">import</span> <span class="n">calculate_pka_oxonium_scheme</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">spycci.functions.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">retrieve_structure</span>

<span class="n">protonated</span> <span class="o">=</span> <span class="n">System</span><span class="p">(</span><span class="s2">&quot;protonated.xyz&quot;</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">spin</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">deprotonated</span> <span class="o">=</span> <span class="n">System</span><span class="p">(</span><span class="s2">&quot;deprotonated.xyz&quot;</span><span class="p">,</span> <span class="n">charge</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">spin</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">water_xyz</span> <span class="o">=</span> <span class="n">retrieve_structure</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">)</span>
<span class="n">water</span> <span class="o">=</span> <span class="n">System</span><span class="p">(</span><span class="s2">&quot;water&quot;</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">spin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="n">water_xyz</span><span class="p">)</span>

<span class="n">oxonium_xyz</span> <span class="o">=</span> <span class="n">retrieve_structure</span><span class="p">(</span><span class="s2">&quot;oxonium&quot;</span><span class="p">)</span>
<span class="n">oxonium</span> <span class="o">=</span> <span class="n">System</span><span class="p">(</span><span class="s2">&quot;oxonium&quot;</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">spin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="n">oxonium_xyz</span><span class="p">)</span>

<span class="n">xtb</span> <span class="o">=</span> <span class="n">XtbInput</span><span class="p">(</span><span class="n">solvent</span><span class="o">=</span><span class="s2">&quot;water&quot;</span><span class="p">)</span>
<span class="n">xtb</span><span class="o">.</span><span class="n">opt</span><span class="p">(</span><span class="n">protonated</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">xtb</span><span class="o">.</span><span class="n">opt</span><span class="p">(</span><span class="n">deprotonated</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">xtb</span><span class="o">.</span><span class="n">opt</span><span class="p">(</span><span class="n">water</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">xtb</span><span class="o">.</span><span class="n">opt</span><span class="p">(</span><span class="n">oxonium</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">pka</span> <span class="o">=</span> <span class="n">calculate_pka_oxonium_scheme</span><span class="p">(</span><span class="n">protonated</span><span class="p">,</span> <span class="n">deprotonated</span><span class="p">,</span> <span class="n">water</span><span class="p">,</span> <span class="n">oxonium</span><span class="p">)</span>
</pre></div>
</div>
<p>The computed pka value is returned as a <code class="docutils literal notranslate"><span class="pre">pKa</span></code> object (with only the <code class="docutils literal notranslate"><span class="pre">oxonium</span></code> property set). The function automatically sets the <code class="docutils literal notranslate"><span class="pre">pka</span></code> property of the <code class="docutils literal notranslate"><span class="pre">protonated</span></code> system accordingly. If this is not desired, the feature can be decativated using the keyword <code class="docutils literal notranslate"><span class="pre">only_return=True</span></code>.</p>
</section>
<section id="the-run-pka-workflow-function">
<h3>The <code class="docutils literal notranslate"><span class="pre">run_pka_workflow()</span></code> function:<a class="headerlink" href="#the-run-pka-workflow-function" title="Link to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">run_pka_workflow</span></code> function, takes as arguments the protomer and deprotomer structures (in the form of <code class="docutils literal notranslate"><span class="pre">System</span></code> objects).
The function takes care of the geometry optimization of both structures in solvent and the calculation of electronic energies and frequencies both in solvent and, if required, in vacuum. The level of theory of each calculation can be set using the <code class="docutils literal notranslate"><span class="pre">method_geometry</span></code>, <code class="docutils literal notranslate"><span class="pre">method_electonic</span></code>, <code class="docutils literal notranslate"><span class="pre">method_vibrational</span></code> keywords. Once all the calculations have been executed, the function then computes the pka using both the direct and the oxonium schemes. If required the function computes also a pka using the COSMO-RS solvation energies using the oxonium scheme. The routine takes as arguments the following elements:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">protonated</span></code> (<code class="docutils literal notranslate"><span class="pre">System</span></code>): The protonated system for which the pKa must be computed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">deprotonated</span></code> (<code class="docutils literal notranslate"><span class="pre">System</span></code>): The deprotomer generated during the dissociation reaction</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">method_vibrational</span></code> (<code class="docutils literal notranslate"><span class="pre">XtbInput</span></code> or <code class="docutils literal notranslate"><span class="pre">OrcaInput</span></code>): The engine to be used to run the frequency calculations.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">method_electonic</span></code> (<code class="docutils literal notranslate"><span class="pre">XtbInput</span></code> or <code class="docutils literal notranslate"><span class="pre">OrcaInput</span></code>): The engine to be used to run the electronic calculations. If set to <code class="docutils literal notranslate"><span class="pre">None</span></code> (default) will use electronic energy computed by the <code class="docutils literal notranslate"><span class="pre">method_vibrational</span></code> engine. Please notice that, if the electronic method is different from the vibrational one, the computed Gibbs Free energy will be a mix of two different levels of theory (not advaisable)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">method_geometry</span></code> (<code class="docutils literal notranslate"><span class="pre">XtbInput</span></code> or <code class="docutils literal notranslate"><span class="pre">OrcaInput</span></code>): The engine to be used to run the geometry optimizations. If set to <code class="docutils literal notranslate"><span class="pre">None</span></code> the user-provided geometries will be use directly without optimization while the water molecule and oxonium ion structures will be otimized using the BP86/def2-TZVPD (as the default OpenCOSMO-RS settings).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">use_cosmors</span></code> (<code class="docutils literal notranslate"><span class="pre">bool</span></code>): If set to <code class="docutils literal notranslate"><span class="pre">True</span></code> will also use OpenCOSMO-RS to compute solvation energies.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">use_engine_settings</span></code> (<code class="docutils literal notranslate"><span class="pre">bool</span></code>): If set to <code class="docutils literal notranslate"><span class="pre">True</span></code> will use the engine level of theory to run the COSMO-RS calculation (not advisable) else the default BP86/def2-TZVPD level of theory will be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ncores</span></code> (<code class="docutils literal notranslate"><span class="pre">Optional[int]</span></code>): The number of cores to be used in the calculations. If set to <code class="docutils literal notranslate"><span class="pre">None</span></code> (default) will use the maximun number of available cores.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">maxcore</span></code> (<code class="docutils literal notranslate"><span class="pre">Optional[int]</span></code>): For the engines that supprots it, the memory assigned to each core used in the computation.</p></li>
</ul>
<p>An example script that can be used to compute the pKa of a molecule is provided in what follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">spycci.engines.xtb</span><span class="w"> </span><span class="kn">import</span> <span class="n">XtbInput</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">spycci.engines.orca</span><span class="w"> </span><span class="kn">import</span> <span class="n">OrcaInput</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">spycci.systems</span><span class="w"> </span><span class="kn">import</span> <span class="n">System</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">spycci.functions.pka</span><span class="w"> </span><span class="kn">import</span> <span class="n">run_pka_workflow</span>

<span class="n">protonated</span> <span class="o">=</span> <span class="n">System</span><span class="p">(</span><span class="s2">&quot;protonated.xyz&quot;</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">spin</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">deprotonated</span> <span class="o">=</span> <span class="n">System</span><span class="p">(</span><span class="s2">&quot;deprotonated.xyz&quot;</span><span class="p">,</span> <span class="n">charge</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">spin</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">xtb</span> <span class="o">=</span> <span class="n">XtbInput</span><span class="p">(</span><span class="n">solvent</span><span class="o">=</span><span class="s2">&quot;water&quot;</span><span class="p">)</span>
<span class="n">orca</span> <span class="o">=</span> <span class="n">OrcaInput</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;BP86&quot;</span><span class="p">,</span> <span class="n">basis_set</span><span class="o">=</span><span class="s2">&quot;def2-TZVPD&quot;</span><span class="p">,</span> <span class="n">solvent</span><span class="o">=</span><span class="s2">&quot;water&quot;</span><span class="p">)</span>

<span class="n">pka</span><span class="p">,</span> <span class="n">optimized_protonated</span> <span class="o">=</span> <span class="n">run_pka_workflow</span><span class="p">(</span>
  <span class="n">protonated</span><span class="p">,</span>
  <span class="n">deprotonated</span><span class="p">,</span>
  <span class="n">method_vibrational</span> <span class="o">=</span> <span class="n">xtb</span><span class="p">,</span>
  <span class="n">method_electonic</span> <span class="o">=</span> <span class="n">orca</span><span class="p">,</span>
  <span class="n">method_geometry</span> <span class="o">=</span> <span class="n">xtb</span><span class="p">,</span>
  <span class="n">use_cosmors</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>The computed pka value is returned as a <code class="docutils literal notranslate"><span class="pre">pKa</span></code> object together with the structure of the protonated molecule optimized in solvent (<code class="docutils literal notranslate"><span class="pre">optimized_protonated</span></code>). Please notice how the pka object in this case is NOT set in the <code class="docutils literal notranslate"><span class="pre">protonated</span></code> object properties but rather in the <code class="docutils literal notranslate"><span class="pre">optimized_protonated</span></code> system since it is referred to the optimized molecular structure that can differ from the input one. <strong>BEWARE that this behavior is conserved also in the <code class="docutils literal notranslate"><span class="pre">method_geometry</span> <span class="pre">=</span> <span class="pre">None</span></code> use case.</strong></p>
</section>
<section id="the-auto-calculate-pka-function">
<h3>The <code class="docutils literal notranslate"><span class="pre">auto_calculate_pka()</span></code> function:<a class="headerlink" href="#the-auto-calculate-pka-function" title="Link to this heading"></a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">auto_calculate_pka</span></code> function takes as main argument the protonated molecule structure (in the form of a <code class="docutils literal notranslate"><span class="pre">System</span></code> object). The molecule is sequentially deprotonated using the CREST deprotomer search routine until the lowest energy deprotomer is identified. Once the deprotomer search has been completed, the structure of both molecules is optimized using the specified level of theory and both electronic and vibronic energies are computed at the user defined level of theory. The routine takes as arguments the following elements:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">protonated</span></code> (<code class="docutils literal notranslate"><span class="pre">System</span></code>): The protonated molecule for which the pKa must be computed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">method_el</span></code> (<code class="docutils literal notranslate"><span class="pre">Engine</span></code>): The computational engine to be used in the electronic level of theory calculations.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">method_vib</span></code> (<code class="docutils literal notranslate"><span class="pre">Engine</span></code>):  The computational engine to be used in the vibronic level of theory calculations. (optional)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">method_opt</span></code> (<code class="docutils literal notranslate"><span class="pre">Engine</span></code>): The computational engine to be used in the geometry optimization of the protonated molecule and its deprotomers. (optional)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ncores</span></code> (<code class="docutils literal notranslate"><span class="pre">int</span></code>): The number of cores to be used in the calculations. (optional)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">maxcore</span></code> (<code class="docutils literal notranslate"><span class="pre">int</span></code>):  For the engines that supprots it, the memory assigned to each core used in the computation. (optional)</p></li>
</ul>
<p>An example script that can be used to compute the pKa of a molecule is provided in what follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">spycci.engines.xtb</span><span class="w"> </span><span class="kn">import</span> <span class="n">XtbInput</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">spycci.systems</span><span class="w"> </span><span class="kn">import</span> <span class="n">System</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">spycci.functions.pka</span><span class="w"> </span><span class="kn">import</span> <span class="n">calculate_pka</span>

<span class="n">protonated</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="n">from_xyz</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;protonated.xyz&quot;</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">spin</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">xtb</span> <span class="o">=</span> <span class="n">XtbInput</span><span class="p">(</span><span class="n">solvent</span><span class="o">=</span><span class="s2">&quot;water&quot;</span><span class="p">)</span>

<span class="n">pka</span><span class="p">,</span> <span class="n">deprotonated</span> <span class="o">=</span> <span class="n">auto_calculate_pka</span><span class="p">(</span>
    <span class="n">protonated</span><span class="p">,</span>
    <span class="n">method_el</span><span class="o">=</span><span class="n">xtb</span><span class="p">,</span>
    <span class="n">method_vib</span><span class="o">=</span><span class="n">xtb</span><span class="p">,</span>
    <span class="n">method_opt</span><span class="o">=</span><span class="n">xtb</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Please notice how the optimized structure of the deprotonated system is also returned together with the pKa value.</p>
</section>
</section>
<hr class="docutils" />
<section id="el-redox-potential">
<h2>1-el redox potential<a class="headerlink" href="#el-redox-potential" title="Link to this heading"></a></h2>
<p>Calculates the one-electron reduction potential of a molecule <span class="math notranslate nohighlight">\(MH_{n}\)</span>, considering a generic reaction of the type:</p>
<div class="math notranslate nohighlight">
\[
MH_{n} \rightarrow M^{\cdot (n-1)-} + n\cdot H^{+} + e^{-}
\]</div>
<p>provided the following arguments:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">oxidised</span></code> (<code class="docutils literal notranslate"><span class="pre">System</span></code>): molecule in its oxidised state</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reduced</span></code> (<code class="docutils literal notranslate"><span class="pre">System</span></code>): molecule in its reduced state</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pH</span></code> (<code class="docutils literal notranslate"><span class="pre">float</span></code>, default: <code class="docutils literal notranslate"><span class="pre">7.0</span></code>): pH at which the reduction potential is calculated</p></li>
</ul>
<p>and returns the reduction potential of the molecule considering the provided states at the provided pH, including eventual PCET mechanisms, calculated as:</p>
<div class="math notranslate nohighlight">
\[
E°_{MH_{n}/M^{\cdot(n-1)-}} = - \frac{G_{M^{\cdot(n-1)-}} - (G_{MH_{n}} + n \cdot G_{H^{+}}) }{F} - E°_{SHE} - n \cdot 0.059 \cdot pH 
\]</div>
<p>where <span class="math notranslate nohighlight">\(G_{M^{\cdot(n-1)-}}\)</span> and <span class="math notranslate nohighlight">\(G_{MH_{n}}\)</span> are calculated summing the electronic + vibronic energies at the selected level of theory, <span class="math notranslate nohighlight">\(G_{H^{+}} = -270.29 kcal/mol\)</span>, <span class="math notranslate nohighlight">\(F = 23.061 kcal/volt–gram-equivalent\)</span>, and <span class="math notranslate nohighlight">\(E_{SHE} = 4.28 V\)</span>.</p>
</section>
<hr class="docutils" />
<section id="fukui-functions">
<h2>Fukui functions<a class="headerlink" href="#fukui-functions" title="Link to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">spycci.functions.calculate_fukui</span></code> function calculates the Fukui functions <span class="math notranslate nohighlight">\(f^+(r)\)</span>, <span class="math notranslate nohighlight">\(f^-(r)\)</span> and <span class="math notranslate nohighlight">\(f^0(r)\)</span> associated with a given molecular geometry. The Fukui functions are computed according to the definitions:</p>
<div class="math notranslate nohighlight">
\[
f^+(r) = \rho_{N+1}(r) - \rho_{N}(r)
\]</div>
<div class="math notranslate nohighlight">
\[
f^-(r) = \rho_{N}(r) - \rho_{N-1}(r)
\]</div>
<div class="math notranslate nohighlight">
\[
f^0(r) = \frac{1}{2} \left[\rho_{N+1}(r) - \rho_{N-1}(r)\right]
\]</div>
<p>Where, given a molecule with <span class="math notranslate nohighlight">\(N\)</span> electrons, <span class="math notranslate nohighlight">\(\rho_{N}(r)\)</span> represents its electronic density while <span class="math notranslate nohighlight">\(\rho_{N\pm1}(r)\)</span> represents the electronic density of the molecule, in the same nuclear configuration, when one electron is either added (<span class="math notranslate nohighlight">\(+1\)</span>) or removed (<span class="math notranslate nohighlight">\(-1\)</span>).</p>
<p>The Fukui functions are both computed as volumetric quantities and saved in a <a class="reference external" href="http://paulbourke.net/dataformats/cube/">Gaussian Cube</a> compatible format in the <code class="docutils literal notranslate"><span class="pre">output_density</span></code> folder and as condensed values saved in the <code class="docutils literal notranslate"><span class="pre">System</span></code> object <code class="docutils literal notranslate"><span class="pre">properties</span></code> attribute in the form of a dictionary. The condensed Fukui functions are computed by applying the <span class="math notranslate nohighlight">\(f^+\)</span>, <span class="math notranslate nohighlight">\(f^-\)</span> and <span class="math notranslate nohighlight">\(f^0\)</span> definitions replacing the charge density with either the Mulliken charges or the Hirshfeld charges (changing the sign accordingly given that a localized electronic density represents an accumulation of electrons hence of negative charge). Please notice how the Hirshfeld charges are supported only by the <code class="docutils literal notranslate"><span class="pre">OrcaInput</span></code> engine.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Please notice how the Fukui cubes contain the localized Mulliken-charge-based Fukui values in place of the atomic charges. This is explained in the first comment line of each cube file and, for sake of clarity, all the files are saved using the extension <code class="docutils literal notranslate"><span class="pre">.fukui.cube</span></code>.</p>
</div>
<p>The function can be called with the following minimal arguments:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">molecule</span></code> (<code class="docutils literal notranslate"><span class="pre">System</span></code>): The molecular structure to be used in the computation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">engine</span></code> (<code class="docutils literal notranslate"><span class="pre">OrcaInput</span></code> or <code class="docutils literal notranslate"><span class="pre">XtbInput</span></code>): The engine defining the level of theory to be used in the calculation.</p></li>
</ul>
<p>The function assumes that the molecule supports only singlet and doublet states and switches the spin multeplicity according to the number of electrons. If different spin states needs to be considered the <code class="docutils literal notranslate"><span class="pre">spins_states</span></code> option can be used to provide the spin multeplicity values as a list.</p>
<p>An example code snippet is provided in what follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">spycci.systems</span><span class="w"> </span><span class="kn">import</span> <span class="n">System</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">spycci.engines.orca</span><span class="w"> </span><span class="kn">import</span> <span class="n">OrcaInput</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">spycci.functions.fukui</span><span class="w"> </span><span class="kn">import</span> <span class="n">calculate_fukui</span>

<span class="n">mol</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="n">from_xyz</span><span class="p">(</span><span class="s2">&quot;./acetaldehyde.xyz&quot;</span><span class="p">)</span>
<span class="n">orca</span> <span class="o">=</span> <span class="n">OrcaInput</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;PBE&quot;</span><span class="p">,</span> <span class="n">basis_set</span><span class="o">=</span><span class="s2">&quot;def2-SVP&quot;</span><span class="p">)</span>

<span class="n">orca</span><span class="o">.</span><span class="n">opt</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">calculate_fukui</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">orca</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
</pre></div>
</div>
<p>That for the acetaldehyde molecule returns the following result:</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>=========================================================
SYSTEM: acetaldehyde
=========================================================

Number of atoms: 7
Charge: 0
Spin multiplicity: 1

********************** GEOMETRY *************************

Total system mass: 44.0526 amu

----------------------------------------------
 index  atom    x (Å)      y (Å)      z (Å)   
----------------------------------------------
 0       C    -3.00790    0.17495    0.13810  
 1       C    -3.66800    1.53034    0.11359  
 2       H    -3.22195    2.19896    0.87341  
 3       H    -4.75895    1.41874    0.29379  
 4       H    -3.56793    1.97830   -0.89850  
 5       O    -2.11052   -0.15105    0.88722  
 6       H    -3.42225   -0.55833   -0.62459  
----------------------------------------------

********************** PROPERTIES *************************

Geometry level of theory: OrcaInput || method: PBE | basis: def2-SVP | solvent: None
Electronic level of theory: OrcaInput || method: PBE | basis: def2-SVP | solvent: None
Vibronic level of theory: OrcaInput || method: PBE | basis: def2-SVP | solvent: None

Electronic energy: -153.528266323306 Eh
Gibbs free energy correction G-E(el): 0.02861407 Eh
Gibbs free energy: -153.499652253306 Eh
pKa: pKa object status is NOT SET


MULLIKEN ANALYSIS
----------------------------------------------
 index  atom   charge    spin
----------------------------------------------
 0       C    0.05436   0.00000  
 1       C    -0.04823  0.00000  
 2       H    0.05176   0.00000  
 3       H    0.05695   0.00000  
 4       H    0.05677   0.00000  
 5       O    -0.17156  0.00000  
 6       H    -0.00005  0.00000  

CONDENSED FUKUI - MULLIKEN
----------------------------------------------
 index  atom    f+      f-      f0
----------------------------------------------
 0       C    0.23610   0.08077   0.15843  
 1       C    -0.11416  -0.02731  -0.07074 
 2       H    0.12882   0.11125   0.12003  
 3       H    0.15563   0.12121   0.13842  
 4       H    0.15492   0.12121   0.13806  
 5       O    0.22073   0.35571   0.28822  
 6       H    0.21797   0.23717   0.22757  

HIRSHFELD ANALYSIS
----------------------------------------------
 index  atom   charge    spin
----------------------------------------------
 0       C    0.14702   0.00000  
 1       C    -0.07279  0.00000  
 2       H    0.04088   0.00000  
 3       H    0.04575   0.00000  
 4       H    0.04567   0.00000  
 5       O    -0.22623  0.00000  
 6       H    0.01970   0.00000  

CONDENSED FUKUI - HIRSHFELD
----------------------------------------------
 index  atom    f+      f-      f0
----------------------------------------------
 0       C    0.28818   0.15946   0.22382  
 1       C    0.07190   0.09734   0.08462  
 2       H    0.05820   0.06063   0.05941  
 3       H    0.09907   0.07355   0.08631  
 4       H    0.09850   0.07352   0.08601  
 5       O    0.25823   0.37205   0.31514  
 6       H    0.12592   0.16345   0.14468  
</pre></div>
</div>
</div>
</div>
<p>The volumetric fukui functions can then be plotted using the built in <code class="docutils literal notranslate"><span class="pre">vmd</span></code> based rendering tool. As an example the following code can be used to render the the <span class="math notranslate nohighlight">\(f^+(r)\)</span> Fukui function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">spycci.tools.vmdtools</span><span class="w"> </span><span class="kn">import</span> <span class="n">render_fukui_cube</span>

<span class="n">render_fukui_cube</span><span class="p">(</span>
    <span class="s2">&quot;./output_densities/acetaldehyde_Fukui_plus.fukui.cube&quot;</span><span class="p">,</span>
    <span class="n">include_negative</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">isovalue</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The rendered volume is saved in a <code class="docutils literal notranslate"><span class="pre">.bmp</span></code> bitmap image format. In the case of the acetaldehyde molecule considered in the example, the following image is obtained:</p>
<a class="bg-primary mb-1 reference internal image-reference" href="../_images/acetaldehyde_fukui_plus.bmp"><img alt="fukui_plus" class="bg-primary mb-1 align-center" src="../_images/acetaldehyde_fukui_plus.bmp" style="width: 600px;" />
</a>
<hr class="footnotes docutils" />
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id2" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>Rodrigo Casasnovas, Joaquin Ortega-Castro, Juan Frau, Josefa Donoso, Francisco Munoz, <em>International Journal of Quantum Chemistry</em>, (<strong>2014</strong>), 114, 1350–1363</p>
</aside>
</aside>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Guide"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>